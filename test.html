<!DOCTYPE html>
<html>
<head>
	<title>0.3js test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="reset.css" type="text/css">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="D3.js"></script>
    <script src="/ace-builds/src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="test.js"></script>
</head>
<body onload="start()">
	<div id="entire">
		<div class="column">
			<pre id="editor">precision mediump float;
uniform float uf_time;
uniform vec2 uv2_resolution;
uniform sampler2D us2_frame;
varying vec2 vv2_v;

uniform float slide; //slide{"default": 0, "min": 0, "max": 10, "step": 0.01}
uniform vec3 color1; //color{"default": 0, "min": 0, "max": 1, "step": 0.01}

float map(vec3 p) {
    return length(p) - 1.;
}

vec3 N(vec3 p) {
    vec2 e = vec2(.001, 0.);
    return normalize(vec3(
        map(p+e.xyy) - map(p-e.xyy),
        map(p+e.yxy) - map(p-e.yxy),
        map(p+e.yyx) - map(p-e.yyx)
    ));
}

float trace(vec3 O, vec3 D, float L) {
    for (int i = 0; i < 32; ++i) {
        vec3 p = O + D * L;
        float d = map(p);
        L += d;
        if (d < .01)
            break;
    }
    return L;
}

void main() {
    vec2 uv = gl_FragCoord.xy / uv2_resolution * 2. - 1.;
    uv.x *= uv2_resolution.x / uv2_resolution.y;
    
    vec3 O = vec3(0., 0., 1. + slide);
    vec3 D = normalize(vec3(uv, -2.));
    
    float l = trace(O, D, 0.);
    vec3 p = O + D * l;
    
    vec3 color = vec3(0.);
    
    if (l < 10.)
        color += color1.rgb * max(0.,dot(normalize(vec3(1.)), N(p)));
    
	gl_FragColor = vec4(pow(color, vec3(.7)), 1.);
}</pre><div id="controls"></div>
		</div><div class="column">
			<canvas id="glcanvas">No WebGL support :(</canvas>
		</div>
	</div>
</body>
</html>